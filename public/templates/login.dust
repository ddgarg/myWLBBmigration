<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>{+title /}</title>
    <link rel="stylesheet" href="../css/mywlappstyle.css">
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/select2.css">
    <link rel="stylesheet" href="../css/font-awesome.css">

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script src="../js/select2.min.js"></script>
    <script type="text/javascript">
        $(window).load(function() {
            $(".loader").fadeOut("slow");
        })
    </script>
</head>
<body>
    <div class="loader"></div>
    <div class="login-page">
        <div class="row">
            <fieldset class="main-box">
                <legend>Login</legend>
                <div class="login-box" >
                    <div id="fb-root"></div>
                    <a onclick="fbLogin();"><div id="facebook"><i class="fa-facebook fa" style="color: hsl(0, 100%, 100%); font-size: 7em; display: block;"></i><div id="connect">Connect with Facebook</div></div></a>
                    <div id="mainlogin">
                        <div id="or"><i class="glyphicon glyphicon-plus white"></i></div>
                        <h1>Welcome to My WishList</h1>
                        <div id="note"><a href="#">Login with your Facebook account to create your wish list.</a></div>
                    </div>
                </div>
            </fieldset>
        </div>
    </div>
    <script>
        window.fbAsyncInit = function() {

            FB.init({
                appId      : '1487541621497369',
                cookie     : true,
                status     : true,
                xfbml      : true,
                version    : 'v1.0'
            });

        };

        function post(path, params, method) {
            method = method || "post";
            var form = document.createElement("form");
            form.setAttribute("method", method);
            form.setAttribute("action", path);

            for(var key in params) {
                if(params.hasOwnProperty(key)) {
                    var hiddenField = document.createElement("input");
                    hiddenField.setAttribute("type", "hidden");
                    hiddenField.setAttribute("name", key);
                    hiddenField.setAttribute("value", params[key]);

                    form.appendChild(hiddenField);
                }
            }

            document.body.appendChild(form);
            form.submit();
        }

        function  fbLogin (){
            FB.login(function(response) {

                 console.log(response);
                 var fbAuthResponse = response.authResponse;
                {!if authenticated load mywishlist page!}
                if (response.authResponse) {
                    post('/mywishlist', {accessToken : fbAuthResponse.accessToken, userId : fbAuthResponse.userID, signedRequest : fbAuthResponse.signedRequest});
                }
                {!else redirect the user to login page!}
                else {
                    window.location="/login";
                    {!console.log('User cancelled login or did not fully authorize.');!}
                }
            },{scope: 'public_profile,email,publish_actions,user_friends,user_birthday'}); {!required permissions!}
        }

        (function() {
            var e = document.createElement('script');
            e.src = document.location.protocol + '//connect.facebook.net/en_US/all.js';
            e.async = true;
            document.getElementById('fb-root').appendChild(e);
        }());
    </script>
    <div id="footer">
        <div class="fl">
            <a href="/" title="Vivek Dogra Website" rel="generator">Copyright &copy; 2014 </a>
            <span class="sep"> | </span>
            <a href="/" rel="owner">Vivek Dogra</a>.
        </div>
    </div>
<script data-main="/js/app" src="/components/requirejs/require.js"></script>
</body>
</html>